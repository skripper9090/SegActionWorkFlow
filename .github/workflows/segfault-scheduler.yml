name: Date Command Scheduler with Delays

on:
  workflow_dispatch:
  schedule:
    - cron: "*/30 * * * *"

jobs:
  run-date-command:
    runs-on: ubuntu-latest
    steps:
      - name: Install dependencies
        run: |
          sudo apt-get update && sudo apt-get install -y sshpass tmux

      - name: Wait 45 seconds before proceeding
        run: |
          echo "Waiting 45 seconds..."
          sleep 45

      - name: Check tmux installation and list sessions on remote
        run: |
          echo "Verifying tmux installation and listing sessions on the remote server..."
          sshpass -p "segfault" ssh \
            -o StrictHostKeyChecking=no \
            -o "SetEnv SECRET=TnouJyPIWNrTiKeOMxWSLtqh" \
            root@lulz.segfault.net "tmux --help; tmux list-sessions"

      - name: Send date command to segauto tmux session
        run: |
          echo "Sending date command to the segauto tmux session..."
          sshpass -p "segfault" ssh \
            -o StrictHostKeyChecking=no \
            -o "SetEnv SECRET=TnouJyPIWNrTiKeOMxWSLtqh" \
            root@lulz.segfault.net "tmux send-keys -t segauto 'date' Enter"
